# PRP-002: CLI 交互式终端设计方案

**状态**: 重新设计中
**优先级**: 高
**创建日期**: 2025-09-10
**最后更新**: 2025-09-10

## 概述

将 Freedom CLI 设计为纯交互式终端界面，当用户输入 `freedom` 时进入交互式会话，支持一级命令和二级交互界面，提供更流畅的用户体验。

## 目标

- 实现纯交互式终端界面
- 支持一级命令结构（如 `/login`, `/logs`）
- 设计二级交互界面支持选项选择和参数输入
- 保持科技感渐变色 Logo 视觉效果
- 提供直观的命令提示和帮助系统

## 设计理念

采用类似聊天界面或终端仿真器的交互模式：
1. **单一入口**: 用户只需输入 `freedom` 启动
2. **一级命令**: 支持 `/command` 格式的简单命令
3. **二级交互**: 命令执行后可进入更深层的交互界面
4. **上下文保持**: 在交互过程中保持会话状态
5. **优雅退出**: 支持 `/exit` 或 `Ctrl+C` 退出

## 实施方案

### Phase 1: 移除 yargs 命令行参数处理 🆕

- [x] 从 `main.ts` 移除交互式模式检测逻辑
- [x] 清理未使用的 `InteractiveMode` 导入
- [x] 简化程序启动流程
- [x] 保持现有 yargs 命令结构

### Phase 2: 实现交互式终端核心 🆕

- [ ] 创建交互式会话管理器
- [ ] 实现命令行输入循环
- [ ] 添加命令解析器（支持 `/command` 格式）
- [ ] 实现基础的一级命令路由

### Phase 3: 设计一级命令结构 🆕

- [ ] `/help` - 显示可用命令列表
- [ ] `/login` - 用户登录和身份验证
- [ ] `/log` - 查看日志和运行记录
- [ ] `/script` - 脚本管理
- [ ] `/task` - 任务管理
- [ ] `/config` - 配置设置
- [ ] `/exit` - 退出程序

### Phase 4: 实现二级交互界面 🆕

- [ ] 选项选择界面（使用方向键或数字选择）
- [ ] 参数输入界面（支持验证和提示）
- [ ] 进度显示和状态反馈
- [ ] 返回上级界面的机制

## 技术细节

### 当前架构简化

**原有流程**:
```
启动 → 检查参数 → 无参数(交互模式) / 有参数(命令模式) → 执行
```

**简化流程**:
```
启动 → 显示 Logo → yargs 处理命令 → 执行
```

### Logo 渐变效果实现

```typescript
// 字符级渐变色算法
function createGradientLine(line: string, startColor: RGB, endColor: RGB): string {
  return line.split('').map((char, index) => {
    const progress = index / (line.length - 1)
    const color = interpolateColor(startColor, endColor, progress)
    return chalk.rgb(...color).bold(char)
  }).join('')
}
```

## 影响分析

### 正面影响

1. **简化架构**: 减少约 30% 的 CLI 相关代码
2. **标准化体验**: 符合标准 Unix CLI 工具习惯
3. **降低复杂度**: 单一命令处理路径，减少 bug 风险
4. **提升性能**: 减少启动时的模式检测开销
5. **视觉提升**: 科技感渐变 Logo 增强品牌形象

### 风险缓解

1. **用户适应**: 提供迁移指南和示例
2. **功能完整性**: 确保所有原有功能通过命令行参数可访问
3. **向后兼容**: 保持所有现有命令和选项不变

## 验收标准

- [ ] 移除所有交互式模式相关代码
- [ ] 保持所有现有命令功能完整
- [ ] 渐变色 Logo 正常显示
- [ ] 所有测试通过
- [ ] 文档更新完成
- [ ] 性能无明显下降

## 时间估算

- **Phase 1**: 0.5 小时 ✅ 完成
- **Phase 2**: 1 小时 ✅ 完成
- **Phase 3**: 1 小时 (进行中)
- **Phase 4**: 1 小时

**总计**: 3.5 小时

## 下一步行动

1. 完成代码清理，移除交互式相关文件
2. 更新文档和使用示例
3. 执行全面测试
4. 准备用户迁移指南

## 相关文件

- `packages/cli/src/main.ts` - 主入口简化
- `packages/cli/src/interactive.ts` - 待删除
- `packages/cli/src/commands/` - 命令定义保持不变
- `README.md` - 使用说明更新
- `CLAUDE.md` - 开发指导更新
