# PRP-002: CLI 交互式终端设计方案

**状态**: 重新设计中
**优先级**: 高
**创建日期**: 2025-09-10
**最后更新**: 2025-09-10

## 目标

- 支持一级命令结构（如 `/login`, `/logs`）
- 设计二级交互界面支持选项选择和参数输入
- 保持科技感渐变色 Logo 视觉效果
- 提供直观的命令提示和帮助系统

## 设计理念

采用纯交互式终端模式，类似聊天界面或终端仿真器：

### 核心原则
1. **纯交互式**: 启动后直接进入交互模式，所有功能通过斜杠命令操作
2. **启动参数**: 命令行参数仅用于配置启动选项（如调试模式、配置文件路径等）
3. **一级命令**: 支持 `/command` 格式的简洁命令，无需复杂参数
4. **二级交互**: 命令执行后进入专用交互界面，通过选择菜单和输入提示完成操作
5. **会话状态**: 保持交互过程中的上下文和状态
6. **优雅退出**: 支持 `/exit` 或 `Ctrl+C` 安全退出

### 命令行参数设计
- `freedom` - 直接启动交互模式（默认）
- `freedom --debug` - 启动调试模式的交互界面
- `freedom --headless` - 启动无头模式的交互界面
- `freedom --help` - 显示启动参数帮助
- `freedom --version` - 显示版本信息

**重要**: 不再支持 `freedom game start` 或 `freedom script run` 等直接命令，所有业务操作均通过交互模式完成。

## 实施方案

### Phase 1: 实现交互式终端核心 🆕

- [ ] 实现命令行输入循环
- [ ] 添加命令解析器（支持 `/command` 格式）
- [ ] 实现基础的一级命令路由

### Phase 2: 设计一级命令结构 🆕

**基础命令**:
- [ ] `/help` - 显示可用命令列表和使用说明
- [ ] `/status` - 查看系统和游戏运行状态
- [ ] `/config` - 配置管理（查看/修改设置）
- [ ] `/exit` - 安全退出程序

**游戏相关命令**:
- [ ] `/login` - 游戏登录和身份验证
- [ ] `/game` - 游戏控制（启动/停止/暂停）
- [ ] `/script` - 脚本管理和执行

**高级功能**:
- [ ] `/log` - 日志查看和管理
- [ ] `/task` - 任务队列管理
- [ ] `/debug` - 调试工具和诊断信息

**扩展命令**:
- [ ] `/extension` - 扩展插件管理

### Phase 3: 实现二级交互界面 🆕

**交互组件**:
- [ ] 选项选择菜单（使用方向键或数字选择）
- [ ] 参数输入界面（支持验证和提示）
- [ ] 确认对话框（重要操作确认）
- [ ] 进度条显示（长时间操作反馈）

**导航机制**:
- [ ] 返回上级界面的机制（ESC 键或 `/back`）
- [ ] 面包屑导航显示当前位置
- [ ] 快捷键支持（Tab 自动补全等）

**示例交互流程**:
```
freedom> /login
┌─ 游戏登录 ─┐
│ 1. 新建登录配置
│ 2. 使用已保存配置
│ 3. 快速登录
└─────────────┘
选择操作 [1-3]: 1

请输入用户名: myuser
请输入密码: ******
请选择服务器:
  1. 官服
  2. B服
选择 [1-2]: 1

正在登录...
[████████████████████] 100% 登录成功！
```

## 技术细节

### 当前架构简化

**原有流程**:
```
启动 → 检查参数 → 无参数(交互模式) / 有参数(命令模式) → 执行
```

**新设计流程**:
```
启动 → 解析启动参数 → 显示 Logo → 进入交互模式 → 斜杠命令处理 → 二级交互
```

### 启动参数处理

```typescript
interface StartupOptions {
  debug?: boolean
  config?: string
  headless?: boolean
  help?: boolean
  version?: boolean
}

// 启动参数仅影响初始化配置，不直接执行业务操作
function parseStartupArgs(args: string[]): StartupOptions
```

### Logo 渐变效果实现

```typescript
// 字符级渐变色算法
function createGradientLine(line: string, startColor: RGB, endColor: RGB): string {
  return line.split('').map((char, index) => {
    const progress = index / (line.length - 1)
    const color = interpolateColor(startColor, endColor, progress)
    return chalk.rgb(...color).bold(char)
  }).join('')
}
```

## 影响分析

### 正面影响

1. **简化架构**: 减少约 30% 的 CLI 相关代码
2. **标准化体验**: 符合标准 Unix CLI 工具习惯
3. **降低复杂度**: 单一命令处理路径，减少 bug 风险
4. **提升性能**: 减少启动时的模式检测开销
5. **视觉提升**: 科技感渐变 Logo 增强品牌形象

### 风险缓解

1. **用户适应**: 提供迁移指南和示例
2. **功能完整性**: 确保所有原有功能通过命令行参数可访问
3. **向后兼容**: 保持所有现有命令和选项不变

## 验收标准

**功能要求**:
- [ ] 移除所有直接业务命令（如 `freedom game start`）
- [ ] 启动参数仅用于配置（debug、config、headless 等）
- [ ] 实现完整的交互式斜杠命令系统
- [ ] 二级交互界面正常工作
- [ ] 所有原有功能通过交互模式可访问

**技术要求**:
- [ ] 渐变色 Logo 正常显示
- [ ] 所有测试通过
- [ ] TypeScript 类型检查通过
- [ ] ESLint 检查无错误
- [ ] 性能无明显下降

**用户体验**:
- [ ] 交互界面直观易用
- [ ] 错误提示清晰友好
- [ ] 快捷键和导航流畅
- [ ] 文档更新完成

## 时间估算

- **Phase 1**: 0.5 小时 ✅ 完成
- **Phase 2**: 1 小时 ✅ 完成
- **Phase 3**: 1 小时 (进行中)
- **Phase 4**: 1 小时

**总计**: 3.5 小时

## 下一步行动

1. 更新文档和使用示例
2. 执行全面测试
3. 准备用户迁移指南

## 相关文件

- `packages/cli/src/main.ts` - 主入口简化
- `packages/cli/src/interactive.ts` - 待删除
- `packages/cli/src/commands/` - 命令定义保持不变
- `README.md` - 使用说明更新
- `CLAUDE.md` - 开发指导更新
