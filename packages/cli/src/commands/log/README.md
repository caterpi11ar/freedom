# `/log` 命令

日志管理系统，提供日志查看、分析和管理功能。

## 功能概述

日志系统提供全面的日志记录、查看、过滤和分析功能，支持多级别日志和实时监控。

## 使用方式

```bash
/log
```

## 交互流程

### 主菜单

```
📋 日志管理系统

当前状态：
- 今日日志: 1,245 条
- 错误日志: 23 条
- 警告日志: 67 条
- 日志文件: 15.2 MB

请选择操作：
1. 查看实时日志
2. 浏览历史日志
3. 日志搜索与过滤
4. 错误日志分析
5. 日志导出
6. 日志设置
7. 返回上一级

请输入选项 (1-7):
```

### 1. 查看实时日志

实时显示系统日志流：

```
📡 实时日志监控 (按 Ctrl+C 退出)

[14:35:22] INFO  [TaskManager] 任务 #001 开始执行
[14:35:23] DEBUG [ScriptEngine] 加载脚本: 每日任务脚本 v2.1
[14:35:24] INFO  [Browser] 浏览器启动成功, PID: 12345
[14:35:25] WARN  [Network] 网络延迟较高: 1500ms
[14:35:26] INFO  [GameClient] 游戏客户端连接成功
[14:35:27] DEBUG [ScriptEngine] 执行动作: 点击登录按钮
[14:35:28] ERROR [GameClient] 登录失败: 验证码错误
[14:35:29] WARN  [TaskManager] 任务重试: 第1次
[14:35:32] INFO  [GameClient] 重新连接成功

过滤选项:
L) 设置日志级别  F) 添加关键词过滤  C) 清除过滤器
P) 暂停显示      R) 恢复显示        S) 保存当前日志
Q) 退出实时模式

当前过滤: [ALL] | 状态: [运行中] | 显示: 实时
```

### 2. 浏览历史日志

查看和浏览历史日志记录：

```
📖 历史日志浏览

时间范围选择：
1. 最近1小时
2. 今日日志
3. 昨日日志
4. 最近7天
5. 最近30天
6. 自定义时间

请选择时间范围 (1-6): 2

今日日志 (2024-01-15):
────────────────────────────────────────
08:30:15 [INFO ] [System] Freedom CLI 启动成功
08:30:16 [DEBUG] [Config] 加载配置文件: ~/.freedom/config.json
08:32:45 [INFO ] [Login] 用户登录: main_account
09:15:23 [ERROR] [Script] 脚本执行失败: timeout
09:15:24 [WARN ] [TaskMgr] 任务 #005 进入重试队列
...

显示: 第1页/共45页 (每页20条)

操作选项:
n) 下一页    p) 上一页    j) 跳转到页面
f) 过滤      s) 搜索      d) 查看详情
e) 导出      q) 返回菜单

请输入操作:
```

### 3. 日志搜索与过滤

高级搜索和过滤功能：

```
🔍 日志搜索与过滤

搜索条件设置：

时间筛选:
- 开始时间: 2024-01-15 09:00:00
- 结束时间: 2024-01-15 18:00:00

级别筛选:
☑ ERROR   ☑ WARN    ☑ INFO    □ DEBUG   □ TRACE

模块筛选:
☑ TaskManager    □ ScriptEngine   ☑ GameClient
□ Network       ☑ Browser        □ Config

关键词搜索:
- 包含关键词: "登录"
- 排除关键词: "debug"
- 正则表达式: 启用

搜索结果 (共23条):
────────────────────────────────────────
09:32:45 [INFO] [GameClient] 用户登录成功: main_account
10:15:22 [WARN] [GameClient] 登录会话即将过期
11:30:18 [ERROR] [GameClient] 登录失败: 网络错误
12:45:33 [INFO] [GameClient] 自动重新登录成功
...

操作: r) 重新搜索  c) 清除条件  e) 导出结果  q) 返回
```

### 4. 错误日志分析

专门的错误日志分析工具：

```
🚨 错误日志分析

错误统计 (最近24小时):
┌─────────────────────┬─────┬─────────┐
│ 错误类型             │ 次数 │ 最新时间  │
├─────────────────────┼─────┼─────────┤
│ 网络连接失败          │  15 │ 14:23:45 │
│ 脚本执行超时          │   8 │ 13:45:12 │
│ 游戏客户端崩溃        │   3 │ 12:30:22 │
│ 配置文件错误          │   2 │ 09:15:08 │
│ 权限不足             │   1 │ 08:45:33 │
└─────────────────────┴─────┴─────────┘

错误趋势分析:
  错误频率: ████████░░ 73% ↑ (相比昨日)
  解决率:   ██████████ 85%
  影响任务: 12个任务受到影响

详细错误列表:
1. [14:23:45] 网络连接失败 - 任务ID: #015
   错误详情: Connection timeout after 30s
   影响: 任务执行中断
   建议: 检查网络连接稳定性

2. [13:45:12] 脚本执行超时 - 脚本: 每日任务v2.1
   错误详情: Script execution timeout (30min)
   影响: 任务未完成
   建议: 优化脚本性能或增加超时时间

操作: d) 查看详情  a) 分析报告  f) 修复建议  q) 返回
```

### 5. 日志导出

导出日志数据用于分析或备份：

```
📦 日志导出

导出配置：

数据范围:
- 时间范围: 2024-01-15 00:00:00 至 2024-01-15 23:59:59
- 日志级别: ☑ ERROR  ☑ WARN  ☑ INFO  □ DEBUG
- 模块选择: ☑ 全部模块

导出格式:
1. JSON格式 (.json) - 结构化数据，便于程序处理
2. CSV格式 (.csv) - 表格数据，便于Excel分析
3. TXT格式 (.txt) - 纯文本，便于查看
4. 压缩包 (.zip) - 包含所有格式

请选择格式 (1-4): 1

导出选项:
☑ 包含堆栈跟踪信息
☑ 包含性能数据
□ 匿名化敏感信息
☑ 生成摘要报告

导出位置: ./exports/logs_20240115.json
预估文件大小: 5.2 MB

确认导出？ (y/N):
```

### 6. 日志设置

配置日志系统参数：

```
⚙️  日志系统设置

日志级别配置:
- 控制台输出级别: INFO
- 文件记录级别: DEBUG
- 错误日志级别: ERROR
- 性能日志: 启用

文件管理:
- 日志文件大小限制: 50MB
- 最大保留文件数: 10
- 自动轮转: 启用
- 压缩旧文件: 启用

显示设置:
- 时间戳格式: YYYY-MM-DD HH:mm:ss
- 颜色高亮: 启用
- 模块名显示: 启用
- 线程ID显示: 禁用

过滤器:
- 敏感信息过滤: 启用
- 重复日志合并: 启用
- 垃圾日志过滤: 启用

性能监控:
- 日志性能统计: 启用
- 慢日志检测: 启用 (>100ms)
- 内存使用监控: 启用

保存设置请输入 's', 重置默认请输入 'r':
```

## 日志级别说明

| 级别 | 描述 | 颜色 | 用途 |
|------|------|------|------|
| TRACE | 最详细的跟踪信息 | 灰色 | 开发调试 |
| DEBUG | 调试信息 | 蓝色 | 问题排查 |
| INFO | 一般信息 | 绿色 | 正常运行状态 |
| WARN | 警告信息 | 黄色 | 潜在问题 |
| ERROR | 错误信息 | 红色 | 需要关注的错误 |

## 日志模块

系统包含的主要日志模块：
- **System** - 系统核心日志
- **TaskManager** - 任务管理日志
- **ScriptEngine** - 脚本执行日志
- **GameClient** - 游戏客户端日志
- **Browser** - 浏览器自动化日志
- **Network** - 网络通信日志
- **Config** - 配置管理日志

## 高级功能

### 智能分析
- 错误模式识别
- 异常趋势分析
- 性能瓶颈检测

### 告警系统
- 错误阈值告警
- 异常模式告警
- 系统状态告警

### 集成功能
- 与任务系统集成
- 错误自动报告
- 性能优化建议

## 相关命令

- [`/task`](../task/README.md) - 任务队列管理
- [`/systemconfig`](../systemconfig/README.md) - 系统配置

## 注意事项

1. **存储空间**: 日志文件会占用磁盘空间，建议定期清理
2. **性能影响**: 高级别日志可能影响系统性能
3. **隐私保护**: 日志中可能包含敏感信息，导出时注意
4. **文件权限**: 确保有足够权限访问日志文件
5. **备份重要性**: 重要日志建议及时备份
