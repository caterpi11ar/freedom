# `/task` 命令

任务队列管理系统，提供任务的创建、调度、监控和历史记录功能。

## 功能概述

任务系统允许用户管理自动化任务，支持单次任务、定时任务和循环任务。提供完整的任务生命周期管理。

## 使用方式

```bash
/task
```

## 交互流程

### 主菜单

```
📋 任务队列管理

当前状态：
- 运行中: 2 个任务
- 等待中: 5 个任务
- 已完成: 15 个任务（今日）

请选择操作：
1. 查看任务列表
2. 创建新任务
3. 管理任务
4. 查看任务历史
5. 系统设置
6. 返回上一级

请输入选项 (1-6):
```

### 1. 查看任务列表

显示所有任务的当前状态：

```
📋 任务列表

🔄 运行中任务:
  [#001] 每日任务脚本 | 账户: main_account | 进度: 75%
         预估剩余: 5 分钟 | 开始时间: 14:30:15

  [#002] 材料收集 | 账户: alt_account | 进度: 45%
         预估剩余: 12 分钟 | 开始时间: 14:25:30

⏳ 等待中任务:
  [#003] 自动战斗 | 优先级: 高 | 预计开始: 15:00:00
  [#004] 每日登录 | 优先级: 普通 | 预计开始: 15:30:00
  [#005] 资源采集 | 优先级: 低 | 预计开始: 16:00:00

⏸️  暂停任务:
  [#006] 长期挂机 | 暂停时间: 13:45:00 | 原因: 用户手动暂停

操作选项：
p) 暂停任务  r) 恢复任务  s) 停止任务  d) 查看详情
q) 返回菜单

请输入操作或任务ID:
```

### 2. 创建新任务

创建新的自动化任务：

```
📝 创建新任务

任务类型选择：
1. 脚本任务 - 运行现有脚本模板
2. 定时任务 - 设置定时执行的任务
3. 循环任务 - 设置重复执行的任务
4. 组合任务 - 多个任务的组合序列

请选择任务类型 (1-4): 1

选择脚本模板：
1. 每日任务脚本 (v2.1) - 完成所有每日任务
2. 自动战斗脚本 (v1.5) - 自动进行战斗
3. 材料收集脚本 (v1.0) - 收集指定材料

请选择脚本 (1-3): 1

任务配置：
- 任务名称: 每日任务自动化
- 账户选择: main_account
- 优先级: [低/普通/高/紧急]: 普通
- 执行时间: [立即/定时]: 立即
- 重试次数: 3
- 超时设置: 30 分钟

确认创建任务？ (y/N):
```

### 3. 管理任务

对任务进行管理操作：

```
🔧 任务管理

选择任务：
  [#003] 自动战斗 | 状态: 等待中 | 优先级: 高

管理操作：
1. 修改优先级
2. 重新调度
3. 编辑配置
4. 查看日志
5. 强制停止
6. 删除任务

请选择操作 (1-6): 1

修改优先级：
当前优先级: 高
新优先级: [低/普通/高/紧急]: 紧急

优先级已更新: 高 → 紧急
任务将在下一个调度周期中优先执行。
```

### 4. 查看任务历史

查看已完成任务的历史记录：

```
📊 任务历史记录

时间筛选：
1. 今日任务
2. 本周任务
3. 本月任务
4. 自定义时间范围

请选择时间范围 (1-4): 1

今日任务记录 (2024-01-15):
✅ [14:00] 每日任务脚本 | 执行成功 | 用时: 18分30秒
✅ [13:30] 自动登录 | 执行成功 | 用时: 2分15秒
❌ [12:00] 材料收集 | 执行失败 | 错误: 网络超时
✅ [11:30] 签到任务 | 执行成功 | 用时: 1分05秒

统计信息：
- 总任务数: 4
- 成功率: 75%
- 总耗时: 21分50秒
- 平均耗时: 5分28秒

操作：
d) 查看详情  r) 重新执行  e) 导出报告
q) 返回菜单
```

### 5. 系统设置

配置任务系统参数：

```
⚙️  任务系统设置

执行设置：
- 最大并发任务数: 3
- 默认超时时间: 30 分钟
- 自动重试次数: 3
- 失败冷却时间: 5 分钟

调度设置：
- 调度间隔: 30 秒
- 优先级权重: 启用
- 智能负载均衡: 启用
- 资源冲突检测: 启用

通知设置：
- 任务完成通知: 启用
- 任务失败通知: 启用
- 每日报告: 启用
- 通知方式: 控制台 + 文件

修改设置请输入对应编号，或输入 's' 保存，'q' 取消:
```

## 任务状态说明

| 状态 | 描述 | 图标 |
|------|------|------|
| pending | 等待执行 | ⏳ |
| running | 正在执行 | 🔄 |
| completed | 执行成功 | ✅ |
| failed | 执行失败 | ❌ |
| paused | 已暂停 | ⏸️ |

## 优先级系统

任务优先级从低到高：
1. **低** - 空闲时执行
2. **普通** - 正常调度执行
3. **高** - 优先执行
4. **紧急** - 立即执行

## 高级功能

### 任务依赖
- 设置任务执行的前置条件
- 支持复杂的依赖关系链
- 自动解决依赖冲突

### 资源管理
- 账户资源占用检测
- 智能资源分配
- 避免资源冲突

### 性能监控
- 任务执行性能统计
- 资源使用率监控
- 系统负载平衡

## 相关命令

- [`/script`](../script/README.md) - 脚本模板管理
- [`/login`](../login/README.md) - 账户管理
- [`/log`](../log/README.md) - 日志查看

## 注意事项

1. **并发限制**: 默认最多同时执行3个任务
2. **资源管理**: 同一账户不能同时执行多个任务
3. **超时机制**: 任务超时会自动终止并标记为失败
4. **数据持久化**: 任务记录会永久保存到本地数据库
5. **安全性**: 任务执行前会进行权限和安全检查
